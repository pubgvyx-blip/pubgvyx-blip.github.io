<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ADMIN PANEL</title>
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, onAuthStateChanged }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, collection, getDocs, deleteDoc, doc, updateDoc }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAdE6pSRtNx9AlEFR2UrFO87_fpFXLg9C4",
  authDomain: "krakenuc-dc537.firebaseapp.com",
  projectId: "krakenuc-dc537"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

async function loadReviews(){
  const querySnapshot = await getDocs(collection(db,"reviews"));
  const list = document.getElementById("reviews");
  list.innerHTML="";
  querySnapshot.forEach((docu)=>{
    list.innerHTML+=`
    <div>
      <b>${docu.data().user}</b>
      <p>${docu.data().text}</p>
      <button onclick="deleteReview('${docu.id}')">Удалить</button>
    </div>`;
  });
}

window.deleteReview = async function(id){
  await deleteDoc(doc(db,"reviews",id));
  loadReviews();
}

async function loadUsers(){
  const querySnapshot = await getDocs(collection(db,"users"));
  const list = document.getElementById("users");
  list.innerHTML="";
  querySnapshot.forEach((docu)=>{
    list.innerHTML+=`
    <div>
      ${docu.data().email}
      <button onclick="blockUser('${docu.id}')">Заблокировать</button>
    </div>`;
  });
}

window.blockUser = async function(id){
  await updateDoc(doc(db,"users",id),{blocked:true});
  alert("Пользователь заблокирован");
}

onAuthStateChanged(auth,(user)=>{
  if(user){
    loadReviews();
    loadUsers();
  }else{
    alert("Нет доступа");
    window.location="index.html";
  }
});

</script>

<body style="background:black;color:white">
<h1>ADMIN PANEL</h1>

<h2>Отзывы</h2>
<div id="reviews"></div>

<h2>Пользователи</h2>
<div id="users"></div>

</body>
</html>
